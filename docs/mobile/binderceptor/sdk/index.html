<!doctype html>
<html lang="zh" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page plugin-docs plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.0.0">
<title data-rh="true">集成开发 | iofomo | Open-source organization</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://www.iofomo.com/docs/mobile/binderceptor/sdk"><meta data-rh="true" property="og:locale" content="zh"><meta data-rh="true" name="docusaurus_locale" content="zh"><meta data-rh="true" name="docsearch:language" content="zh"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="集成开发 | iofomo | Open-source organization"><meta data-rh="true" name="description" content="☞ Github ☜　　☞ Gitee ☜"><meta data-rh="true" property="og:description" content="☞ Github ☜　　☞ Gitee ☜"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://www.iofomo.com/docs/mobile/binderceptor/sdk"><link data-rh="true" rel="alternate" href="https://www.iofomo.com/docs/mobile/binderceptor/sdk" hreflang="zh"><link data-rh="true" rel="alternate" href="https://www.iofomo.com/docs/mobile/binderceptor/sdk" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="iofomo | Open-source organization RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="iofomo | Open-source organization Atom Feed"><link rel="stylesheet" href="/assets/css/styles.510b357b.css">
<script src="/assets/js/runtime~main.35643c6b.js" defer="defer"></script>
<script src="/assets/js/main.e2c25420.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><header class="sticky top-0 z-10"><div class="absolute top-0 left-0 right-0 backdrop-blur-[6px] landing-md:backdrop-blur-[12px] z-[-1] bg-gray-0 dark:bg-gray-900 bg-opacity-80 dark:bg-opacity-80 pointer-events-none transition-colors duration-150 ease-in-out" style="top:-10px;bottom:-60px;-webkit-mask-image:linear-gradient(to bottom, transparent 0, transparent calc(0% + 10px), black calc(0% + 10px), black calc(100% - 60px), transparent calc(100% - 60px));mask-image:linear-gradient(to bottom, transparent 0, transparent calc(0% + 10px), black calc(0% + 10px), black calc(100% - 60px), transparent calc(100% - 60px))"></div><div class="relative z-[1] p-4 landing-sm:px-8 landing-md:py-5"><div class="mx-auto flex items-center justify-between max-w-[896px] landing-lg:max-w-[1200px]"><div class="w-[70px] landing-lg:w-[70px]"><a href="/"><img src="/img/logo-dark.png" class="text-gray-900 dark:text-gray-0"></a></div><div style="width:40px;height:100%"></div><div class="hidden landing-md:flex flex-1 items-center gap-8"><div id="popover-桌面端" class="relative inline-flex items-center" data-headlessui-state=""><button class="inline-flex items-center text-sm leading-6 font-normal" type="button" aria-expanded="false" data-headlessui-state=""><span class="text-gray-900 dark:text-gray-300 transition-colors duration-150 ease-in-out inline-block">桌面端</span><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" aria-hidden="true" class="transition duration-150 ease-out -mr-2 text-gray-500 dark:text-gray-400"><path fill="currentColor" fill-rule="evenodd" d="M15.707 9.793a1 1 0 0 0-1.414 0L12 12.086 9.707 9.793a1 1 0 0 0-1.414 1.414l3 3a1 1 0 0 0 1.414 0l3-3a1 1 0 0 0 0-1.414Z" clip-rule="evenodd"></path></svg></button></div><div style="position:fixed;top:1px;left:1px;width:1px;height:0;padding:0;margin:-1px;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border-width:0;display:none"></div><div id="popover-移动端" class="relative inline-flex items-center" data-headlessui-state=""><button class="inline-flex items-center text-sm leading-6 font-normal" type="button" aria-expanded="false" data-headlessui-state=""><span class="text-gray-900 dark:text-gray-300 transition-colors duration-150 ease-in-out inline-block">移动端</span><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" aria-hidden="true" class="transition duration-150 ease-out -mr-2 text-gray-500 dark:text-gray-400"><path fill="currentColor" fill-rule="evenodd" d="M15.707 9.793a1 1 0 0 0-1.414 0L12 12.086 9.707 9.793a1 1 0 0 0-1.414 1.414l3 3a1 1 0 0 0 1.414 0l3-3a1 1 0 0 0 0-1.414Z" clip-rule="evenodd"></path></svg></button></div><div style="position:fixed;top:1px;left:1px;width:1px;height:0;padding:0;margin:-1px;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border-width:0;display:none"></div><div id="popover-服务" class="relative inline-flex items-center" data-headlessui-state=""><button class="inline-flex items-center text-sm leading-6 font-normal" type="button" aria-expanded="false" data-headlessui-state=""><span class="text-gray-900 dark:text-gray-300 transition-colors duration-150 ease-in-out inline-block">服务</span><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" aria-hidden="true" class="transition duration-150 ease-out -mr-2 text-gray-500 dark:text-gray-400"><path fill="currentColor" fill-rule="evenodd" d="M15.707 9.793a1 1 0 0 0-1.414 0L12 12.086 9.707 9.793a1 1 0 0 0-1.414 1.414l3 3a1 1 0 0 0 1.414 0l3-3a1 1 0 0 0 0-1.414Z" clip-rule="evenodd"></path></svg></button></div><div style="position:fixed;top:1px;left:1px;width:1px;height:0;padding:0;margin:-1px;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border-width:0;display:none"></div><a class="inline-flex items-center gap-2 text-sm leading-6 font-normal text-gray-900 dark:text-gray-300 transition-colors duration-150 ease-in-out no-underline hover:text-gray-900 dark:hover:text-white" href="/blog">博客</a></div><div class="hidden landing-md:flex items-center justify-end gap-4 w-[130px] landing-lg:w-[200px]"><div class="navbarSearchContainer_Bca1"><div class="navbar__search"><span aria-label="expand searchbar" role="button" class="search-icon" tabindex="0"></span><input id="search_input_react" type="search" placeholder="Loading..." aria-label="Search" class="navbar__search-input search-bar" disabled=""></div></div><div class="separator" aria-hidden="true"></div><a href="https://github.com/iofomo/fomosite" target="_blank" rel="noreferrer" class="flex gap-2 items-center font-normal text-sm leading-6 text-gray-500 dark:text-gray-400 hover:text-gray-400 dark:hover:text-gray-300 hover:no-underline transition-colors duration-200 ease-in-out"><svg width="16" height="16" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg" class="w-6 h-6"><path fill-rule="evenodd" clip-rule="evenodd" d="M11.053 0A10.904 10.904 0 0 0 3.89 2.685 11.34 11.34 0 0 0 .142 9.472a11.48 11.48 0 0 0 1.456 7.65 11.087 11.087 0 0 0 5.964 4.86c.556.103.752-.25.752-.547v-1.918C5.23 20.202 4.58 18 4.58 18a3.012 3.012 0 0 0-1.227-1.655c-.997-.692.081-.692.081-.692.35.05.683.18.975.382.293.202.536.469.713.78.15.278.352.523.595.721a2.312 2.312 0 0 0 2.618.221c.042-.57.283-1.105.678-1.509-2.454-.284-5.03-1.253-5.03-5.539a4.415 4.415 0 0 1 1.132-3.025A4.194 4.194 0 0 1 5.224 4.7s.928-.305 3.036 1.156c1.81-.508 3.72-.508 5.531 0 2.108-1.46 3.03-1.156 3.03-1.156.406.936.455 1.993.135 2.963a4.415 4.415 0 0 1 1.132 3.026c0 4.334-2.582 5.282-5.043 5.538.264.271.468.597.598.955.13.358.182.741.155 1.122V21.4c0 .367.196.65.759.54a11.093 11.093 0 0 0 5.88-4.878 11.481 11.481 0 0 0 1.419-7.6 11.34 11.34 0 0 0-3.71-6.746A10.907 10.907 0 0 0 11.053 0Z" fill="currentColor"></path></svg></a><a href="https://gitee.com/iofomo/fomosite" target="_blank" rel="noreferrer" class="flex gap-2 items-center font-normal text-sm leading-6 text-gray-500 dark:text-gray-400 hover:text-gray-400 dark:hover:text-gray-300 hover:no-underline transition-colors duration-200 ease-in-out"><svg width="16" height="16" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="w-6 h-6"><path fill-rule="evenodd" clip-rule="evenodd" d="M512 1024C229.222 1024 0 794.778 0 512S229.222 0 512 0s512 229.222 512 512-229.222 512-512 512z m259.149-568.883h-290.74a25.293 25.293 0 0 0-25.292 25.293l-0.026 63.206c0 13.952 11.315 25.293 25.267 25.293h177.024c13.978 0 25.293 11.315 25.293 25.267v12.646a75.853 75.853 0 0 1-75.853 75.853h-240.23a25.293 25.293 0 0 1-25.267-25.293V417.203a75.853 75.853 0 0 1 75.827-75.853h353.946a25.293 25.293 0 0 0 25.267-25.292l0.077-63.207a25.293 25.293 0 0 0-25.268-25.293H417.152a189.62 189.62 0 0 0-189.62 189.645V771.15c0 13.977 11.316 25.293 25.294 25.293h372.94a170.65 170.65 0 0 0 170.65-170.65V480.384a25.293 25.293 0 0 0-25.293-25.267z" fill="currentColor" p-id="8186"></path></svg></a><button type="button" class="appearance-none focus:outline-none relative w-10 h-10 rounded-full border border-solid border-gray-300 dark:border-gray-700 text-gray-500 transition-colors duration-150 ease-in-out overflow-hidden flex-shrink-0 group"><div class="absolute w-full h-full flex items-center justify-center flex-shrink-0 top-10 translate-y-0 dark:-translate-y-10 duration-200 ease-in-out transition-transform"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="none"><path fill="currentColor" d="M8 5.818c1.2 0 2.182.982 2.182 2.182S9.2 10.182 8 10.182 5.818 9.2 5.818 8 6.8 5.818 8 5.818Zm0-1.454A3.638 3.638 0 0 0 4.364 8 3.638 3.638 0 0 0 8 11.636 3.638 3.638 0 0 0 11.636 8 3.638 3.638 0 0 0 8 4.364ZM.727 8.727h1.455A.73.73 0 0 0 2.909 8a.73.73 0 0 0-.727-.727H.727A.73.73 0 0 0 0 8c0 .4.327.727.727.727Zm13.091 0h1.455A.73.73 0 0 0 16 8a.73.73 0 0 0-.727-.727h-1.455a.73.73 0 0 0-.727.727c0 .4.327.727.727.727Zm-6.545-8v1.455c0 .4.327.727.727.727a.73.73 0 0 0 .727-.727V.727A.73.73 0 0 0 8 0a.73.73 0 0 0-.727.727Zm0 13.091v1.455c0 .4.327.727.727.727a.73.73 0 0 0 .727-.727v-1.455A.73.73 0 0 0 8 13.091a.73.73 0 0 0-.727.727ZM3.629 2.604a.724.724 0 1 0-1.025 1.025l.77.771A.724.724 0 1 0 4.4 3.375l-.77-.771Zm8.997 8.996a.724.724 0 1 0-1.026 1.026l.77.77a.724.724 0 1 0 1.025-1.025l-.77-.771Zm.77-7.97a.724.724 0 1 0-1.025-1.025l-.771.77A.724.724 0 1 0 12.626 4.4l.77-.77ZM4.4 12.624A.724.724 0 1 0 3.375 11.6l-.771.772a.724.724 0 1 0 1.025 1.025l.771-.77Z"></path></svg></div><div class="absolute w-full h-full flex items-center justify-center flex-shrink-0 top-10 -translate-y-10 dark:translate-y-0 duration-200 ease-in-out transition-transform"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="none"><path fill="currentColor" fill-rule="evenodd" d="M6.563 1.66a6.5 6.5 0 1 0 7.778 7.777A5.5 5.5 0 0 1 6.563 1.66ZM0 8A8 8 0 0 1 9.526.146a.75.75 0 0 1 .033 1.465A4.002 4.002 0 0 0 10.5 9.5a4.002 4.002 0 0 0 3.889-3.06.75.75 0 0 1 1.466.034A8 8 0 1 1 0 8Z" clip-rule="evenodd"></path></svg></div></button></div></div></div></header><div id="__docusaurus_skipToContent_fallback" class="main-wrapper"><div class="docsWrapper_hBAB"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd sidebarWithHideableNavbar_wUlq"><a tabindex="-1" class="sidebarLogo_isFc" target="_self" href="/"><img src="/img/logo-dark.png" alt="iofomo Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo-dark.png" alt="iofomo Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></a><nav aria-label="文档侧边栏" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/mobile/binderceptor/Introduce">Binderceptor</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/docs/mobile/binderceptor/sdk">集成开发</a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="flex justify-center mx-auto max-w-screen-blog-max w-full"><div class="flex-1 flex flex-col items-center justify-start px-4 sm:px-0 py-4 sm:py-14 w-full"><div class="max-w-screen-content w-full"><div class="refine-prose"><div class="theme-doc-markdown markdown"><h1>集成开发</h1>
<p><a href="https://www.github.com/iofomo/binderceptor" target="_blank" rel="noopener noreferrer">☞ Github ☜</a>　　<a href="https://www.gitee.com/iofomo/binderceptor" target="_blank" rel="noopener noreferrer">☞ Gitee ☜</a></p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="环境配置">环境配置<a href="#环境配置" class="hash-link" aria-label="环境配置的直接链接" title="环境配置的直接链接">​</a></h3>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="基础环境">基础环境<a href="#基础环境" class="hash-link" aria-label="基础环境的直接链接" title="基础环境的直接链接">​</a></h4>
<ul>
<li><code>Android Studio：</code>4.2</li>
<li><code>Gradle：</code>6.9.2</li>
<li><code>NDK：</code>21.4.7075529</li>
<li><code>Python：</code>2.7.x/3.x</li>
</ul>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="库依赖">库依赖<a href="#库依赖" class="hash-link" aria-label="库依赖的直接链接" title="库依赖的直接链接">​</a></h4>
<div class="language-groovy codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-groovy codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">dependencies {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    implementation (name: &#x27;cmpt-mts-binderceptor&#x27;, ext: &#x27;aar&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="日志打印">日志打印<a href="#日志打印" class="hash-link" aria-label="日志打印的直接链接" title="日志打印的直接链接">​</a></h3>
<p>提供了三个不同级别的<code>Binder</code>日志输出，级别可叠加，由于应用进程<code>Binder</code>通信机器频繁，因此建议通常只需开启<code>SIMPLE</code>级别即可。</p>
<p>接口定义如下：</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">package android.app.ifma.mts.binderceptor;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class BinderceptorManager {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 首先需要初始化</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static void init() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        callNative(INIT, 0, null);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static int EBinderceptorDemoFlag_Print_Simple           = 0x1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static int EBinderceptorDemoFlag_Print_Transaction_Data = 0x2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static int EBinderceptorDemoFlag_Print_Write_Read       = 0x4;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 默认不输出日志，可以设置日志输出级别</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static void setLogger(int flag) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        callNative(SET_LOGGER, flag, null);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="simple日志">Simple日志<a href="#simple日志" class="hash-link" aria-label="Simple日志的直接链接" title="Simple日志的直接链接">​</a></h4>
<p>输出内容如下：（包含<code>Binder</code>服务名称和方法<code>Code</code>值）</p>
<div class="language-tex codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-tex codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Binder::tgt: 0x9e77682, 10002: com.huawei.iaware.sdk.ISDKManager</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Binder::tgt: 0x3887b52, 147: android.content.pm.IPackageManager</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Binder::tgt: 0x76c2822, 56: com.huawei.android.view.IHwWindowManager</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Binder::tgt: 0xdc3c612, 41: com.huawei.android.app.IHwActivityTaskManager</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Binder::tgt: 0x367556e, 2: android.view.IWindowSession</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Binder::tgt: 0x255ce27, 3: android.magicwin.IHwMagicWindow</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Binder::tgt: 0x76c2822, 56: com.huawei.android.view.IHwWindowManager</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Binder::tgt: 0x984dc75, 24: android.content.pm.IShortcutService</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Binder::tgt: 0x9a978a2, 21: android.content.IContentProvider</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Binder::tgt: 0x19c1b12, 10: android.aps.IHwApsManager</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="transaction_data日志">Transaction_Data日志：<a href="#transaction_data日志" class="hash-link" aria-label="Transaction_Data日志：的直接链接" title="Transaction_Data日志：的直接链接">​</a></h4>
<p>输出内容如下：（包含<code>txn</code>完整数据结构内容，特别是参数内容）</p>
<div class="language-tex codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-tex codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Trace   : target:       1   cookie:       0   code:      23   flags:   0x12(READ REPLY)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Trace   :    pid:       0      uid:       0   size:     196    offs:8</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Trace   : 00000000:  00 00 00 80 ff ff ff ff  54 53 59 53 1c 00 00 00  ........TSYS....</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Trace   : 00000010:  61 00 6e 00 64 00 72 00  6f 00 69 00 64 00 2e 00  a.n.d.r.o.i.d...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Trace   : 00000020:  61 00 70 00 70 00 2e 00  49 00 41 00 63 00 74 00  a.p.p...I.A.c.t.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Trace   : 00000030:  69 00 76 00 69 00 74 00  79 00 4d 00 61 00 6e 00  i.v.i.t.y.M.a.n.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Trace   : 00000040:  61 00 67 00 65 00 72 00  00 00 00 00 85 2a 62 73  a.g.e.r......*bs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Trace   : 00000050:  13 01 00 00 00 38 dd 2a  71 00 00 b4 00 05 e9 31  .....8.*q......1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Trace   : 00000060:  71 00 00 b4 01 00 00 0c  1a 00 00 00 63 00 6f 00  q...........c.o.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Trace   : 00000070:  6d 00 2e 00 69 00 66 00  6d 00 61 00 2e 00 74 00  m...i.f.m.a...t.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Trace   : 00000080:  72 00 61 00 6e 00 73 00  65 00 63 00 2e 00 63 00  r.a.n.s.e.c...c.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Trace   : 00000090:  6f 00 6e 00 74 00 61 00  69 00 6e 00 65 00 72 00  o.n.t.a.i.n.e.r.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Trace   : 000000a0:  00 00 00 00 08 00 00 00  73 00 65 00 74 00 74 00  ........s.e.t.t.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Trace   : 000000b0:  69 00 6e 00 67 00 73 00  00 00 00 00 00 00 00 00  i.n.g.s.........</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Trace   : 000000c0:  01 00 00 00                                       ....</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Trace   : binder object offs:0x4c  type:0x73622a85  flags:0x113  ptr:0x2add3800  cookie:0x31e90500</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="write_read日志">Write_Read日志：<a href="#write_read日志" class="hash-link" aria-label="Write_Read日志：的直接链接" title="Write_Read日志：的直接链接">​</a></h4>
<p>输出内容如下：（包含第一层<code>Binder</code>通信命令内容）</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">write_buffer:0xb400007107d1d400, write_consumed:68, write_size:68</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">00000000:  00 63 40 40 14 00 00 00  00 00 00 00 00 00 00 00  .c@@............</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">00000010:  00 00 00 00 01 00 00 00  12 00 00 00 00 00 00 00  ................</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">00000020:  00 00 00 00 54 00 00 00  00 00 00 00 00 00 00 00  ....T...........</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">00000030:  00 00 00 00 00 4d 3a ac  70 00 00 b4 00 00 00 00  .....M:.p.......</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">00000040:  00 00 00 00                                       ....</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">BR_NOOP: 0x720c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">BR_TRANSACTION_COMPLETE: 0x7206</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">BR_REPLY: 0</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="参数过滤">参数过滤<a href="#参数过滤" class="hash-link" aria-label="参数过滤的直接链接" title="参数过滤的直接链接">​</a></h3>
<p>由于<code>Binder</code>通信日志繁多，无法甄别，因此我们需要过滤接口，比如只需要打印那些方法的参数中包含目标内容。如只打印那些<code>Binder</code>通信中包含字符串&quot;com.demo&quot;（<code>Binder</code>通信字符通常为<code>uint16_t</code>宽字符）内容的调用日志。</p>
<p>由于Binder通信调用分为同步（<code>target</code>）和异步（<code>oneway</code>）两种方式，因此需要在对应的两个方法回调中处理，如：</p>
<div class="language-c++ codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c++ codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// target argument：com.demo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">static uint16_t g_debug_target[] = {&#x27;c&#x27;,&#x27;o&#x27;,&#x27;m&#x27;,&#x27;.&#x27;,&#x27;d&#x27;,&#x27;e&#x27;,&#x27;m&#x27;,&#x27;o&#x27;};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">static const uint32_t g_debug_target_length = 8;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">static bool doCheckService(binder_txn_st* txn, TBinderInfo&amp; pInfo, TBinderTokenItem&amp; token, bool oneway) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if ((txn-&gt;data_size &lt; sizeof(g_debug_target) + sizeof(int32_t))) return false;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    const uint8_t *ptr = (const uint8_t *) txn-&gt;data.ptr.buffer;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    for (int i=0, len = txn-&gt;data_size-sizeof(g_debug_target)-sizeof(int32_t); i &lt;= len; ++i) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        uint32_t* intPtr = (uint32_t*)(ptr + i);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (*intPtr != g_debug_target_length) continue;// fast length check</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (memcmp(ptr + i + sizeof(int32_t), g_debug_target, sizeof(g_debug_target)) != 0) continue;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // match then print</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        token.print(txn, oneway);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return true;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">bool BinderceptorDebug::onFrameworkBinderTarget(binder_txn_st* txn, TBinderInfo&amp; pInfo, TBinderTokenItem&amp; token) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (token.isInvalid()) return false;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return doCheckService(txn, pInfo, token, false);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">bool BinderceptorDebug::onFrameworkBinderOneway(binder_txn_st* txn, TBinderInfo&amp; pInfo, TBinderTokenItem&amp; token) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (token.isInvalid()) return false;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return doCheckService(txn, pInfo, token, true);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="数据修改">数据修改<a href="#数据修改" class="hash-link" aria-label="数据修改的直接链接" title="数据修改的直接链接">​</a></h3>
<p>有些时候我们需要修改通信的参数，这里我们以当应用查找对应应用（<code>com.demo</code>）是否存在时，我们始终返回不存在为例，如：</p>
<blockquote>
<p>这里以应用程序调用如下方法为例：</p>
<p>PackageInfo getPackageInfo(String packageName, int flags, int userId);</p>
</blockquote>
<div class="language-c++ codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c++ codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// target server: android.content.pm.IPackageManager</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">static uint16_t g_debug_server[] = {&#x27;a&#x27;,&#x27;n&#x27;,&#x27;d&#x27;,&#x27;r&#x27;,&#x27;o&#x27;,&#x27;i&#x27;,&#x27;d&#x27;,&#x27;.&#x27;,&#x27;c&#x27;,&#x27;o&#x27;,&#x27;n&#x27;,&#x27;t&#x27;,&#x27;e&#x27;,&#x27;n&#x27;,&#x27;t&#x27;,&#x27;.&#x27;,&#x27;p&#x27;,&#x27;m&#x27;,&#x27;.&#x27;,&#x27;I&#x27;,&#x27;P&#x27;,&#x27;a&#x27;,&#x27;c&#x27;,&#x27;k&#x27;,&#x27;a&#x27;,&#x27;g&#x27;,&#x27;e&#x27;,&#x27;M&#x27;,&#x27;a&#x27;,&#x27;n&#x27;,&#x27;a&#x27;,&#x27;g&#x27;,&#x27;e&#x27;,&#x27;r&#x27;};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">static const uint32_t g_debug_server_length = 34;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// target argument：com.demo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">static uint16_t g_debug_target[] = {&#x27;c&#x27;,&#x27;o&#x27;,&#x27;m&#x27;,&#x27;.&#x27;,&#x27;d&#x27;,&#x27;e&#x27;,&#x27;m&#x27;,&#x27;o&#x27;};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">static const uint32_t g_debug_target_length = 8;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">static bool pms_get_package_info(binder_txn_st* txn, TBinderInfo&amp; pInfo, TBinderTokenItem&amp; token, bool oneway) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    BinderParcel* pr = __PARCEL_NEW_DATA((const uint8_t*)(txn-&gt;data.ptr.buffer), txn-&gt;data_size);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (__UNLIKELY(!pr)) return false;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    __PARCEL_AUTO_FREE(pr);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (0 != pr-&gt;skipToken()) return false;// skip strict model and token</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    size_t len = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    const char16_t* pkg16 = pr-&gt;readString16Inplace(&amp;len);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (g_debug_target_length != len || !pkg16) return 0;// maybe package name = &quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (memcmp(pkg16, g_debug_target, sizeof(g_debug_target)) == 0) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // changed the package arguments</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ((char16_t*)pkg16)[len-1] = &#x27; &#x27;;// fix, make sure throw name not found exception</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return true;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return false;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *   如何找到对应的方法Code：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *   1. FindClass(&quot;android/content/pm/IPackageManager$Stub&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *   2. 获取静态成员的值：&quot;TRANSACTION_getPackageInfo&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">bool BinderceptorDebug::onFrameworkBinderTarget(binder_txn_st* txn, TBinderInfo&amp; pInfo, TBinderTokenItem&amp; token) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (token.isInvalid()) return false;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (txn-&gt;code == 10) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    	   return doCheckService(txn, pInfo, token, false);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return false;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">bool BinderceptorDebug::onFrameworkBinderOneway(binder_txn_st* txn, TBinderInfo&amp; pInfo, TBinderTokenItem&amp; token) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (token.isInvalid()) return false;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (txn-&gt;code == 10 &amp;&amp; token.isTargetToken(g_debug_server, g_debug_server_length)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    	   return doCheckService(txn, pInfo, token, true);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return false;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="调用拦截">调用拦截<a href="#调用拦截" class="hash-link" aria-label="调用拦截的直接链接" title="调用拦截的直接链接">​</a></h3>
<p>如果需要直接拒绝调用此函数，则需要告诉Binder拦截框架，然后处理拦截后返回的数据。</p>
<blockquote>
<p>这里以应用程序调用如下方法为例：</p>
<p>ParcelFileDescriptor openDevice(String deviceName, String packageName);</p>
</blockquote>
<div class="language-c++ codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c++ codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">#define BINDER_TARGET_SERVER				  1// do not changed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#define BINDER_TARGET_SERVER_OPEN_DEVICE		1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// target server: android.hardware.usb.IUsbManager</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">static uint16_t g_debug_server[] = {&#x27;a&#x27;,&#x27;n&#x27;,&#x27;d&#x27;,&#x27;r&#x27;,&#x27;o&#x27;,&#x27;i&#x27;,&#x27;d&#x27;,&#x27;.&#x27;&#x27;h&#x27;,&#x27;a&#x27;,&#x27;r&#x27;,&#x27;d&#x27;,&#x27;w&#x27;,&#x27;a&#x27;,&#x27;r&#x27;,&#x27;e&#x27;,&#x27;.&#x27;,&#x27;u&#x27;,&#x27;s&#x27;,&#x27;b&#x27;,&#x27;.&#x27;,&#x27;I&#x27;,&#x27;U&#x27;,&#x27;s&#x27;,&#x27;b&#x27;,&#x27;M&#x27;,&#x27;a&#x27;,&#x27;n&#x27;,&#x27;a&#x27;,&#x27;g&#x27;,&#x27;e&#x27;,&#x27;r&#x27;};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">static const uint32_t g_debug_server_length = 32;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *   如何找到对应的方法Code：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *   1. FindClass(&quot;android/hardware/usb/IUsbManager$Stub&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *   2. 获取静态成员的值：&quot;TRANSACTION_OpenDdevice&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">bool BinderceptorDebug::onFrameworkBinderTarget(binder_txn_st* txn, TBinderInfo&amp; pInfo, TBinderTokenItem&amp; token) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (token.isInvalid()) return false;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (txn-&gt;code == 10) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    	   return doCheckService(txn, pInfo, token, false);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return false;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">bool BinderceptorDebug::onFrameworkBinderOneway(binder_txn_st* txn, TBinderInfo&amp; pInfo, TBinderTokenItem&amp; token) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (token.isInvalid()) return false;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (txn-&gt;code == 10 &amp;&amp; token.isTargetToken(g_debug_server, g_debug_server_length)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         pInfo.type = BINDER_TARGET_SERVER;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         pInfo.method = BINDER_TARGET_SERVER_OPEN_DEVICE;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         pInfo.addAction(EIoctlAction_After_Faker);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    	   return true;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return false;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">void BinderceptorDebug::onFrameworkBinderAfterFaker(BinderParcel&amp; reply, TBinderInfo&amp; pInfo) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 在这里修复返回的结果，以保证上层调用不出错</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (BINDER_TARGET_SERVER_OPEN_DEVICE == pInfo.method) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        reply.writeInt32(0);// no Exception</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        reply.writeInt32(0);// no object</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><footer class="flex flex-col gap-6 mt-16 mb-6"><div class="flex items-start justify-between content-md:items-center flex-col content-md:flex-row gap-4"><div><a href="https://github.com/iofomo/fomosite/blob/main/website/docs/mobile/binderceptor/sdk.md" target="_blank" rel="noreferrer noopener" class="text-refine-link-light dark:text-refine-link-dark text-xs content-4xl:text-sm underline">Edit this page</a></div></div></footer></div><div class="max-w-screen-content w-full"><div class="grid grid-cols-2 gap-4 2xl:gap-8 w-full"><a class="group flex-1 p-4 2xl:p-6 rounded-lg border border-gray-200 dark:border-gray-700 hover:bg-gray-100 hover:dark:bg-gray-700 hover:no-underline" href="/docs/mobile/binderceptor/Introduce"><div class="flex-1 flex items-start justify-center flex-col gap-2 2xl:gap-4 text-left"><div class="flex items-center gap-2 text-xs leading-3 content-md:text-sm content-md:leading-6 text-gray-500 dark:text-gray-300 text-xs content-md:text-sm content-4xl:text-lg"><span class="bg-gray-100 dark:bg-gray-800 dark:bg-opacity-50 group-hover:bg-gray-50 dark:group-hover:bg-gray-800 dark:group-hover:bg-opacity-100 flex items-center justify-center rounded w-6 h-6"><svg width="12" height="8" viewBox="0 0 12 8" fill="none" xmlns="http://www.w3.org/2000/svg" class="text-gray-400 dark:text-gray-500"><path fill-rule="evenodd" clip-rule="evenodd" d="M4.70711 0.292893C4.31658 -0.0976311 3.68342 -0.097631 3.29289 0.292893L0.292893 3.29289C-0.0976314 3.68342 -0.0976314 4.31658 0.292893 4.70711L3.29289 7.70711C3.68342 8.09763 4.31658 8.09763 4.70711 7.70711C5.09763 7.31658 5.09763 6.68342 4.70711 6.29289L3.41421 5L11 5C11.5523 5 12 4.55228 12 4C12 3.44772 11.5523 3 11 3L3.41421 3L4.70711 1.70711C5.09763 1.31658 5.09763 0.683417 4.70711 0.292893Z" fill="currentColor"></path></svg></span>上一页</div><span class="text-xs content-md:text-base content-4xl:text-xl text-refine-link-light dark:text-refine-link-dark underline ml-8">Binderceptor</span></div></a></div></div></div><div class="hidden xl:block sticky right-0 top-[67px] max-w-[280px] overflow-auto h-[calc(100vh-67px)] scrollbar-hidden pl-3 pr-3 py-12 border-l border-l-gray-100 dark:border-l-gray-700"><ul><li><a href="#环境配置" class="refine-toc-item pl-7 py-2 pr-3 hover:bg-gray-200/40 dark:hover:bg-gray-700/80 dark:hover:text-gray-0 text-gray-500 hover:text-gray-900 dark:text-gray-500 bg-opacity-0 dark:bg-opacity-0 hover:!text-gray-900 dark:hover:!text-gray-0 rounded-lg transition-colors duration-200 ease-in-out block text-sm leading-6 no-underline hover:no-underline">环境配置</a></li><li><a href="#基础环境" class="refine-toc-item pl-11 py-2 pr-3 hover:bg-gray-200/40 dark:hover:bg-gray-700/80 dark:hover:text-gray-0 text-gray-500 hover:text-gray-900 dark:text-gray-500 bg-opacity-0 dark:bg-opacity-0 hover:!text-gray-900 dark:hover:!text-gray-0 rounded-lg transition-colors duration-200 ease-in-out block text-sm leading-6 no-underline hover:no-underline">基础环境</a></li><li><a href="#库依赖" class="refine-toc-item pl-11 py-2 pr-3 hover:bg-gray-200/40 dark:hover:bg-gray-700/80 dark:hover:text-gray-0 text-gray-500 hover:text-gray-900 dark:text-gray-500 bg-opacity-0 dark:bg-opacity-0 hover:!text-gray-900 dark:hover:!text-gray-0 rounded-lg transition-colors duration-200 ease-in-out block text-sm leading-6 no-underline hover:no-underline">库依赖</a></li><li><a href="#日志打印" class="refine-toc-item pl-7 py-2 pr-3 hover:bg-gray-200/40 dark:hover:bg-gray-700/80 dark:hover:text-gray-0 text-gray-500 hover:text-gray-900 dark:text-gray-500 bg-opacity-0 dark:bg-opacity-0 hover:!text-gray-900 dark:hover:!text-gray-0 rounded-lg transition-colors duration-200 ease-in-out block text-sm leading-6 no-underline hover:no-underline">日志打印</a></li><li><a href="#simple日志" class="refine-toc-item pl-11 py-2 pr-3 hover:bg-gray-200/40 dark:hover:bg-gray-700/80 dark:hover:text-gray-0 text-gray-500 hover:text-gray-900 dark:text-gray-500 bg-opacity-0 dark:bg-opacity-0 hover:!text-gray-900 dark:hover:!text-gray-0 rounded-lg transition-colors duration-200 ease-in-out block text-sm leading-6 no-underline hover:no-underline">Simple日志</a></li><li><a href="#transaction_data日志" class="refine-toc-item pl-11 py-2 pr-3 hover:bg-gray-200/40 dark:hover:bg-gray-700/80 dark:hover:text-gray-0 text-gray-500 hover:text-gray-900 dark:text-gray-500 bg-opacity-0 dark:bg-opacity-0 hover:!text-gray-900 dark:hover:!text-gray-0 rounded-lg transition-colors duration-200 ease-in-out block text-sm leading-6 no-underline hover:no-underline">Transaction_Data日志：</a></li><li><a href="#write_read日志" class="refine-toc-item pl-11 py-2 pr-3 hover:bg-gray-200/40 dark:hover:bg-gray-700/80 dark:hover:text-gray-0 text-gray-500 hover:text-gray-900 dark:text-gray-500 bg-opacity-0 dark:bg-opacity-0 hover:!text-gray-900 dark:hover:!text-gray-0 rounded-lg transition-colors duration-200 ease-in-out block text-sm leading-6 no-underline hover:no-underline">Write_Read日志：</a></li><li><a href="#参数过滤" class="refine-toc-item pl-7 py-2 pr-3 hover:bg-gray-200/40 dark:hover:bg-gray-700/80 dark:hover:text-gray-0 text-gray-500 hover:text-gray-900 dark:text-gray-500 bg-opacity-0 dark:bg-opacity-0 hover:!text-gray-900 dark:hover:!text-gray-0 rounded-lg transition-colors duration-200 ease-in-out block text-sm leading-6 no-underline hover:no-underline">参数过滤</a></li><li><a href="#数据修改" class="refine-toc-item pl-7 py-2 pr-3 hover:bg-gray-200/40 dark:hover:bg-gray-700/80 dark:hover:text-gray-0 text-gray-500 hover:text-gray-900 dark:text-gray-500 bg-opacity-0 dark:bg-opacity-0 hover:!text-gray-900 dark:hover:!text-gray-0 rounded-lg transition-colors duration-200 ease-in-out block text-sm leading-6 no-underline hover:no-underline">数据修改</a></li><li><a href="#调用拦截" class="refine-toc-item pl-7 py-2 pr-3 hover:bg-gray-200/40 dark:hover:bg-gray-700/80 dark:hover:text-gray-0 text-gray-500 hover:text-gray-900 dark:text-gray-500 bg-opacity-0 dark:bg-opacity-0 hover:!text-gray-900 dark:hover:!text-gray-0 rounded-lg transition-colors duration-200 ease-in-out block text-sm leading-6 no-underline hover:no-underline">调用拦截</a></li></ul></div></div></div></main></div></div></div><footer class="footer"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">iofomo</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://book.douban.com/review/5045014/" target="_blank" rel="noopener noreferrer" class="footer__link-item">One leaf, one bodhi, one flower, one world.</a></li></ul></div><div class="col footer__col"><div class="footer__title">知识社区</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://blog.csdn.net/chendianbo?type=blog" target="_blank" rel="noopener noreferrer" class="footer__link-item">CSDN</a></li><li class="footer__item"><a href="https://blog.51cto.com/u_16282197" target="_blank" rel="noopener noreferrer" class="footer__link-item">51CTO</a></li><li class="footer__item"><a href="https://www.zhihu.com/people/pang-bo-zi-75" target="_blank" rel="noopener noreferrer" class="footer__link-item">知乎</a></li></ul></div><div class="col footer__col"><div class="footer__title">技术社区</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://bbs.kanxue.com/user-home-909890.htm" target="_blank" rel="noopener noreferrer" class="footer__link-item">看雪</a></li><li class="footer__item"><a href="https://juejin.cn/user/3424295591361992/posts" target="_blank" rel="noopener noreferrer" class="footer__link-item">掘金</a></li><li class="footer__item"><a href="https://www.jianshu.com/u/aaf9e93735b9" target="_blank" rel="noopener noreferrer" class="footer__link-item">简书</a></li></ul></div><div class="col footer__col"><div class="footer__title">开源社区</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.gitee.com/iofomo" target="_blank" rel="noopener noreferrer" class="footer__link-item">Gitee</a></li><li class="footer__item"><a href="https://www.github.com/iofomo" target="_blank" rel="noopener noreferrer" class="footer__link-item">Github</a></li><li class="footer__item"><a href="https://www.docusaurus.io" target="_blank" rel="noopener noreferrer" class="footer__link-item">Docusaurus</a></li></ul></div><div class="col footer__col"><div class="footer__title">更多</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/about/Introduce">关于我们</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/about/privacy">隐私协议</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 iofomo Inc. Built with Docusaurus.<a style="text-decoration:none" href="http://beian.miit.gov.cn"><p style="color:darkgray">湘ICP备2023024246号-1</p></a></div></div></div></footer></div>
</body>
</html>